# 批量创建用户（user01 到 user11，密码 123456）

说明
- 使用 `pgcrypto` 的 `crypt('123456', gen_salt('bf', 10))` 生成 bcrypt（cost=10）哈希，避免明文存储，保持与后端 `bcrypt.hashSync(password, 10)` 一致。
- 统一为 `VISITOR` 角色；若不存在则先插入或更新。
- 采用 heredoc，复制即可运行；在容器内可省略 `-h localhost`。

前置条件
- 已存在表结构：`"Role"(id, code, name)` 与 `"User"(id, username, passwordHash, nickname, roleId, createdAt)`，且 `username` 唯一。
- 如未创建表，请参考 `pg使用.md` 的“创建表结构示例”。

批量创建（11 个用户：user01..user11，密码 123456）
-- 启用 pgcrypto（用于 bcrypt）
-- 确保默认角色存在
-- 批量插入用户（user01..user11），密码哈希为 bcrypt(123456)

```sh
psql -h localhost -U postgres -d appdb <<'SQL'
CREATE EXTENSION IF NOT EXISTS pgcrypto;

INSERT INTO "Role" ("code","name")
VALUES ('VISITOR','访问者')
ON CONFLICT ("code") DO UPDATE SET "name" = EXCLUDED."name";

INSERT INTO "User" ("username","passwordHash","nickname","roleId")
SELECT 'user' || to_char(i, 'FM00') AS username,
       crypt('123456', gen_salt('bf', 10)) AS passwordHash,
       'user' || to_char(i, 'FM00') AS nickname,
       (SELECT id FROM "Role" WHERE "code"='VISITOR') AS roleId
FROM generate_series(1, 11) AS g(i)
ON CONFLICT ("username") DO NOTHING;
SQL
```

验证（查看创建结果）
```sh
psql -h localhost -U postgres -d appdb <<'SQL'
SELECT id, username, nickname, roleId, createdAt
FROM "User"
WHERE username LIKE 'user%'
ORDER BY username;
-- 校验 user01 的哈希是否可用（应返回 true）
SELECT crypt('123456', "passwordHash") = "passwordHash" AS ok
FROM "User" WHERE username='user01';
SQL
```

如需清理（可选）
```sh
psql -h localhost -U postgres -d appdb <<'SQL'
DELETE FROM "User" WHERE username LIKE 'user%';
SQL
```